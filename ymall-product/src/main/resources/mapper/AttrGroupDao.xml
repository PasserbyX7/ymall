<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yinn.ymall.product.dao.AttrGroupDao">
    <resultMap id="spuAttrGroupDTO" type="com.yinn.ymall.product.dto.ItemDTO$SpuAttrGroupDTO">
        <result property="groupName" column="attr_group_name"/>
        <collection property="attrs" ofType="com.yinn.ymall.product.dto.ItemDTO$SpuAttrDTO">
            <result property="attrName" column="attr_name"/>
            <result property="attrValues" column="attr_value"/>
        </collection>
    </resultMap>
    <select id="listSpuAttrGroupDTOs" resultMap="spuAttrGroupDTO">
        SELECT
            ag.`name` attr_group_name,
            a.`name` attr_name,
            sav.`attr_value`
        FROM
            pms_attr_group ag
            LEFT JOIN pms_attr_attr_group_relation aagr ON aagr.attr_group_id = ag.id
            LEFT JOIN pms_attribute a ON a.id = aagr.attr_id
            LEFT JOIN pms_spu_attr_value sav ON sav.attr_id = a.id
        WHERE
            ag.category_id = #{categoryId} AND sav.spu_id = #{spuId}
    </select>
</mapper>